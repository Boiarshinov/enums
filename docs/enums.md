# Перечисления в Java

## Содержание
- Перечисления
    - Что такое перечисления
    - ООП и перечисления
    - Недостатки перечислений
- Коллекции перечислений
    - Множество `EnumSet`
    - Отображение `EnumMap`
- Использование перечислений в веб-приложениях
    - Получение 
    - Хранение

## Перечисления

### Что такое перечисления
Перечисления появились в Java 1.5, когда ведущим разработчиком Java 
был Джошуа Блох.

### ООП и перечисления

### Недостатки перечислений

## Коллекции перечислений
О преимуществах использования коллекций, специализированных для перечислений,
пишет многие известные Java-разработчики: Джошуа Блох, [Тагир Валеев][Tagir] и др.
Коллекции перечислений появились в Java одновременно с перечислениями.

### Множество `EnumSet`
При рассмотрении множеств перечислений в примерах будет использоваться 
следующий класс:
```java
public enum ProfileType {
    GUEST, USER, MODERATOR, ADMIN
}
```  

Для создания экземпляров множеств `EnumSet` используются только статические методы,
объявленные в этом классе: 
- `of()` - создает множество из переданных перечислений одного типа;
- `allOf()` - создает множество из всех элементов указанного типа перечисления;
- `noneOf()` - создает пустое множество элементов указанного типа перечисления;
- `range()` - создает множество перечислений, начиная и заканчивая 
указанными элементами.
```java
EnumSet<ProfileType> onlyStaff = EnumSet.of(ProfileType.ADMIN, ProfileType.MODERATOR);
EnumSet<ProfileType> all = EnumSet.allOf(ProfileType.class);
EnumSet<ProfileType> empty = EnumSet.noneOf(ProfileType.class);
EnumSet<ProfileType> rangeSet = EnumSet.range(ProfileType.GUEST, ProfileType.MODERATOR);
```
Метод `range()` применять опасно, так как при изменении порядка элементов 
перечисления метод может начать работать не так, как ожидается, либо вообще 
будет падать с исключением.
Сообщение исключения при этом будет нести мало смысла:
```
java.lang.IllegalArgumentException: MODERATOR > GUEST
```

Есть еще два метода, позволяющие создать новый экземпляр множества 
на основе существующего:
- `complementOf()` - создает множество, содержащее элементы, 
отсутствующие в исходном множестве
- `copyOf()` - копирует переданное множество перечислений 
```java
EnumSet<ProfileType> onlyClients = EnumSet.complementOf(onlyStaff);
EnumSet<ProfileType> copiedSet = EnumSet.copyOf(onlyClients);
```

Класс `EnumSet` является абстрактным и у него два наследника:
- `RegularEnumSet`
- `JumboEnumSet`

//картинка UML-диаграммы с данными классами. (добавить туда приватные классы итераторов)

Объект какого класса создастся при вызове одного из статических методов генерации,
зависит от количества элементов перечисления. Если в перечислении объявлено не
больше 64 элементов, то будет создан объект класса `RegularEnumSet`, 
в ином случае - `JumboEnumSet`.
Наследники являются package-private, поэтому выбрать нужную реализацию 
самостоятельно не получится.

### Отображение `EnumMap`

## Использование перечислений в веб-приложениях

### Получение
// Про конвертеры для `@RequestParam`, `@PathParam`

### Хранение
// Про `@Enumerate`, конвертеры, и хранение перечислений в PostgreSQL и MySQL
Рассуждения:
Тут я не знаю насколько это правильно использовать одно и то же перечисление и 
на уровне репозиториев, и в бизнес-логике, и на уровне ресурсов. 
Понятно, что бизнес-логика оперирует самими перечислениями. 
Получается, что в перечислении хранятся строковые названия типов, 
характерные для БД и для ресурсов. 
Получается, что здесь мы нарушаем SRP, так как класс начинает иметь 
несколько причин для изменения. 
С другой стороны вынесение преобразований строк в перечисления делает 
код хрупким для изменений. 
Допустим мы добавили новое перечисление, но при этом забыли добавить нужный 
метод в конвертере. О своей оплошности мы вспомним только в рантайме. 
Для того чтобы не забыть об этом можно написать тест, который будет 
контролировать, что конвертер охватывает все возможные значения перечисления. 
//тут можно привести пример такого конвертера и теста на него

    
## Список источников
- библиотеки `java.lang`, `java.util`
- Джошуа Блох. Java. Эффективное программирование - 2017 г.
- Тагир Валеев. [Коллекции в Java: о чем многие забывают][Tagir]
- Vlad Mihalcea. [The best way to map an Enum Type with JPA and Hibernate][Mihalcea]



[Tagir]: https://habr.com/ru/post/267389/
[Mihalcea]: https://vladmihalcea.com/the-best-way-to-map-an-enum-type-with-jpa-and-hibernate/